<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacks - Find Books at Your Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Condensed:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: white;
            color: #000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1rem;
            position: relative;
            overflow-x: hidden;
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .header {
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 6rem;
            font-weight: 700;
            text-align: center;
            letter-spacing: 0.1em;
            color: #8154a8;
            text-transform: uppercase;
        }

        .header-lottie {
            width: 90px;
            height: 90px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            text-align: center;
            margin-bottom: 3rem;
            max-width: 600px;
            color: #666;
        }

        .progress-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 3px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #8154a8;
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        .question-container {
            max-width: 600px;
            width: 100%;
            text-align: center;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 20px;
            border: 1px solid #e9ecef;
            padding: 2rem;
            position: relative;
        }

        .question {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.6s ease;
            position: relative;
            width: 100%;
        }

        .question.active {
            opacity: 1;
            transform: translateY(0);
            position: relative;
        }

        .question h2 {
            font-size: 1.8rem;
            font-weight: 500;
            margin-bottom: 2rem;
            line-height: 1.4;
            color: #000;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            background: #fff;
            border: 2px solid #e9ecef;
            color: #000;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
        }

        .option:hover {
            background: #8154a8;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(129, 84, 168, 0.3);
        }

        .location-input {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            background: #fff;
            border: 2px solid #e9ecef;
            color: #000;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-family: inherit;
        }

        .location-input:focus {
            outline: none;
            border-color: #8154a8;
            background: #f8f9fa;
        }

        .location-input::placeholder {
            color: #6c757d;
        }

        .continue-btn {
            background: #8154a8;
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .continue-btn:hover {
            background: #6b4687;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(129, 84, 168, 0.4);
        }

        .continue-btn:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress {
            position: absolute;
            top: 2rem;
            right: 2rem;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.7;
            color: #000;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }

        .results-container {
            display: none;
            max-width: 1200px;
            width: 100%;
            margin-top: 2rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.2rem;
            opacity: 0.8;
            color: #000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f0f0f0;
            border-top: 4px solid #8154a8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
            background: #f8f9fa;
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid #e9ecef;
        }

        .results-header h2 {
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .location-info {
            font-size: 1rem;
            opacity: 0.8;
            color: #666;
        }

        .api-status {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            font-size: 0.9rem;
        }

        .api-status.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .api-status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .book-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(129, 84, 168, 0.2);
            border-color: #8154a8;
        }

        .book-cover {
            width: 120px;
            height: 180px;
            background: #f0f0f0;
            border: 1px solid #e9ecef;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #6c757d;
            border-radius: 8px;
            overflow: hidden;
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #000;
        }

        .book-author {
            font-size: 1rem;
            font-weight: 400;
            opacity: 0.8;
            margin-bottom: 1rem;
            color: #666;
        }

        .book-details {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 1rem;
            color: #666;
        }

        .availability {
            background: #f0f0f0;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1rem;
            margin-top: auto;
        }

        .available {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .availability-status {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #000;
        }

        .available .availability-status {
            color: #155724;
        }

        .library-info {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: #666;
        }

        .library-link {
            display: inline-block;
            background: #8154a8;
            color: white;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 0.2rem 0.2rem 0 0;
        }

        .library-link:hover {
            background: #6b4687;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(129, 84, 168, 0.4);
        }

        .restart-btn {
            margin: 3rem auto 3rem;
            background: #8154a8;
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            display: block;
        }

        .restart-btn:hover {
            background: #6b4687;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(129, 84, 168, 0.4);
        }

        @keyframes bookBounce {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-2deg); }
            50% { transform: translateY(0px) rotate(0deg); }
            75% { transform: translateY(-3px) rotate(2deg); }
        }

        @media (max-width: 768px) {
            .header {
                font-size: 3rem;
                margin-bottom: 1rem;
            }

            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .header-lottie {
                width: 60px;
                height: 60px;
            }
            
            .subtitle {
                font-size: 1rem;
                margin-bottom: 2rem;
            }
            
            .question h2 {
                font-size: 1.4rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }

            .progress {
                position: static;
                text-align: center;
                margin-bottom: 1rem;
            }

            .question-container {
                padding: 1.5rem;
            }

            body {
                padding: 2rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="progress">
        <span id="current-question">1</span> / 7
    </div>

    <div class="header-container">
        <h1 class="header">Stacks</h1>
        <div class="header-lottie" id="header-lottie"></div>
    </div>
    <p class="subtitle">Crack Your Next Book</p>

    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <div class="question-container" id="question-container">
        <!-- Questions will be dynamically inserted here -->
    </div>

    <div class="results-container" id="results-container">
        <div class="results-header">
            <h2>Your Book Matches</h2>
            <div class="location-info" id="location-display"></div>
        </div>
        
        <div class="api-status" id="api-status" style="display: none;">
            <!-- API status messages will appear here -->
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div>Finding your matches...</div>
        </div>
        
        <div class="results-grid" id="results-grid">
            <!-- Results will be dynamically inserted here -->
        </div>
        <button class="restart-btn" onclick="restartQuiz()">Discover more books</button>
    </div>

    <script>
        console.log('🚀 Starting Stacks...');

        // Update progress bar
        function updateProgress() {
            const progressFill = document.getElementById('progress-fill');
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            progressFill.style.width = progress + '%';
        }
        
        // Questions array
        const questions = [
            {
                question: "What's your reading vibe right now?",
                options: ["Heart-pounding excitement", "Cozy and comforting", "Make me think deeply", "Warm and emotional"]
            },
            {
                question: "How much reading time do you have?",
                options: ["A quick escape (under 250 pages)", "Perfect weekend read (250-400 pages)", "I'm committed (400-600 pages)", "Bring on the epic (600+ pages)"]
            },
            {
                question: "What genre family calls to you?",
                options: ["Stories that feel real", "Fantasy & sci-fi adventures", "True stories & real people", "Help me learn & grow"]
            },
            {
                question: "Who's this book for?",
                options: ["Me (adult content welcome)", "Young adult (16-25 vibe)", "Younger reader (10-15)", "Family-friendly for everyone"]
            },
            {
                question: "What's your book discovery style?",
                options: ["Give me the crowd favorites", "I want hidden gems", "Mix of popular and unique", "I trust your judgment"]
            },
            {
                question: "When it comes to publication date?",
                options: ["Fresh off the press (2020+)", "Modern classics (2000-2020)", "Timeless favorites (1990s-2000s)", "Age doesn't matter to me"]
            },
            {
                question: "Where are you located?",
                isLocation: true
            }
        ];

        // Comprehensive book database - 50 bestselling books across genres
        const books = [
            // Contemporary Fiction & Literary Fiction
            {
                title: "The Seven Husbands of Evelyn Hugo",
                author: "Taylor Jenkins Reid",
                isbn: "9781501161933",
                genre: "Contemporary Fiction",
                published: "2017",
                ageGroup: "Adult",
                pages: 400,
                covers: ["https://books.google.com/books/content?id=WI5PDQAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "Where the Crawdads Sing",
                author: "Delia Owens",
                isbn: "9780735219090",
                genre: "Literary Fiction",
                published: "2018",
                ageGroup: "Adult",
                pages: 384,
                covers: ["https://books.google.com/books/content?id=mSc5DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            },
            {
                title: "The Midnight Library",
                author: "Matt Haig",
                isbn: "9780525559474",
                genre: "Literary Fiction",
                published: "2020",
                ageGroup: "Adult",
                pages: 288,
                covers: ["https://books.google.com/books/content?id=yZ-wDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "Normal People",
                author: "Sally Rooney",
                isbn: "9781635572414",
                genre: "Contemporary Fiction",
                published: "2018",
                ageGroup: "Adult",
                pages: 288,
                covers: ["https://books.google.com/books/content?id=rKhcDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.0
            },
            {
                title: "The Song of Achilles",
                author: "Madeline Miller",
                isbn: "9780062060624",
                genre: "Literary Fiction",
                published: "2011",
                ageGroup: "Adult",
                pages: 352,
                covers: ["https://books.google.com/books/content?id=YFylr_C6z1EC&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "Circe",
                author: "Madeline Miller",
                isbn: "9780316556323",
                genre: "Literary Fiction",
                published: "2018",
                ageGroup: "Adult",
                pages: 400,
                covers: ["https://books.google.com/books/content?id=aX09DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "Eleanor Oliphant Is Completely Fine",
                author: "Gail Honeyman",
                isbn: "9780735220683",
                genre: "Contemporary Fiction",
                published: "2017",
                ageGroup: "Adult",
                pages: 336,
                covers: ["https://books.google.com/books/content?id=6Y5QDgAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            },
            {
                title: "Little Fires Everywhere",
                author: "Celeste Ng",
                isbn: "9780735224292",
                genre: "Contemporary Fiction",
                published: "2017",
                ageGroup: "Adult",
                pages: 352,
                covers: ["https://books.google.com/books/content?id=rrOODQAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            },
            {
                title: "The Vanishing Half",
                author: "Brit Bennett",
                isbn: "9780525536291",
                genre: "Literary Fiction",
                published: "2020",
                ageGroup: "Adult",
                pages: 352,
                covers: ["https://books.google.com/books/content?id=rZSkDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            },
            {
                title: "Anxious People",
                author: "Fredrik Backman",
                isbn: "9781501160837",
                genre: "Literary Fiction",
                published: "2019",
                ageGroup: "Adult",
                pages: 352,
                covers: ["https://books.google.com/books/content?id=2jN-DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },

            // Fantasy & Science Fiction
            {
                title: "The House in the Cerulean Sea",
                author: "TJ Klune",
                isbn: "9781250217318",
                genre: "Fantasy",
                published: "2020",
                ageGroup: "Adult",
                pages: 394,
                covers: ["https://books.google.com/books/content?id=Y8u8DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "Dune",
                author: "Frank Herbert",
                isbn: "9780441172719",
                genre: "Science Fiction",
                published: "1965",
                ageGroup: "Adult",
                pages: 688,
                covers: ["https://books.google.com/books/content?id=B1hSG45JCX4C&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "The Name of the Wind",
                author: "Patrick Rothfuss",
                isbn: "9780756404079",
                genre: "Fantasy",
                published: "2007",
                ageGroup: "Adult",
                pages: 672,
                covers: ["https://books.google.com/books/content?id=AZ8aAOcZTSYC&printsec=frontcover&img=1&zoom=1"],
                rating: 4.5
            },
            {
                title: "The Hobbit",
                author: "J.R.R. Tolkien",
                isbn: "9780547928227",
                genre: "Fantasy",
                published: "1937",
                ageGroup: "Family",
                pages: 366,
                covers: ["https://books.google.com/books/content?id=pD6arNyKyi8C&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "Harry Potter and the Sorcerer's Stone",
                author: "J.K. Rowling",
                isbn: "9780439708180",
                genre: "Fantasy",
                published: "1997",
                ageGroup: "Young Adult",
                pages: 309,
                covers: ["https://books.google.com/books/content?id=wrOQLV6xB-wC&printsec=frontcover&img=1&zoom=1"],
                rating: 4.5
            },
            {
                title: "Project Hail Mary",
                author: "Andy Weir",
                isbn: "9780593135204",
                genre: "Science Fiction",
                published: "2021",
                ageGroup: "Adult",
                pages: 496,
                covers: ["https://books.google.com/books/content?id=NmT2DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.5
            },
            {
                title: "The Martian",
                author: "Andy Weir",
                isbn: "9780553418026",
                genre: "Science Fiction",
                published: "2011",
                ageGroup: "Adult",
                pages: 384,
                covers: ["https://books.google.com/books/content?id=1Ar0DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "Klara and the Sun",
                author: "Kazuo Ishiguro",
                isbn: "9780593318171",
                genre: "Science Fiction",
                published: "2021",
                ageGroup: "Adult",
                pages: 320,
                covers: ["https://books.google.com/books/content?id=CY3_DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.0
            },

            // Thriller & Mystery
            {
                title: "The Silent Patient",
                author: "Alex Michaelides",
                isbn: "9781250301697",
                genre: "Thriller",
                published: "2019",
                ageGroup: "Adult",
                pages: 336,
                covers: ["https://books.google.com/books/content?id=2ZRSDQAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            },
            {
                title: "Gone Girl",
                author: "Gillian Flynn",
                isbn: "9780307588371",
                genre: "Thriller",
                published: "2012",
                ageGroup: "Adult",
                pages: 432,
                covers: ["https://books.google.com/books/content?id=O4cXnL9fu5kC&printsec=frontcover&img=1&zoom=1"],
                rating: 4.0
            },
            {
                title: "The Girl with the Dragon Tattoo",
                author: "Stieg Larsson",
                isbn: "9780307454546",
                genre: "Mystery",
                published: "2005",
                ageGroup: "Adult",
                pages: 590,
                covers: ["https://books.google.com/books/content?id=o5yhmFMu-m8C&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "Big Little Lies",
                author: "Liane Moriarty",
                isbn: "9780399167065",
                genre: "Mystery",
                published: "2014",
                ageGroup: "Adult",
                pages: 460,
                covers: ["https://books.google.com/books/content?id=kJFCAwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "The Thursday Murder Club",
                author: "Richard Osman",
                isbn: "9781984880987",
                genre: "Mystery",
                published: "2020",
                ageGroup: "Adult",
                pages: 368,
                covers: ["https://books.google.com/books/content?id=hD3MDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "The Guest List",
                author: "Lucy Foley",
                isbn: "9780062868930",
                genre: "Thriller",
                published: "2020",
                ageGroup: "Adult",
                pages: 320,
                covers: ["https://books.google.com/books/content?id=TLqhDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.0
            },

            // Romance
            {
                title: "It Ends with Us",
                author: "Colleen Hoover",
                isbn: "9781501110368",
                genre: "Romance",
                published: "2016",
                ageGroup: "Adult",
                pages: 384,
                covers: ["https://books.google.com/books/content?id=vdWJCwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "The Hating Game",
                author: "Sally Thorne",
                isbn: "9780062439598",
                genre: "Romance",
                published: "2016",
                ageGroup: "Adult",
                pages: 384,
                covers: ["https://books.google.com/books/content?id=yUP_DAAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "Beach Read",
                author: "Emily Henry",
                isbn: "9780451489869",
                genre: "Romance",
                published: "2020",
                ageGroup: "Adult",
                pages: 352,
                covers: ["https://books.google.com/books/content?id=Hfy_DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            },
            {
                title: "People We Meet on Vacation",
                author: "Emily Henry",
                isbn: "9781984806758",
                genre: "Romance",
                published: "2021",
                ageGroup: "Adult",
                pages: 364,
                covers: ["https://books.google.com/books/content?id=gT3_DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "Red, White & Royal Blue",
                author: "Casey McQuiston",
                isbn: "9781250316776",
                genre: "Romance",
                published: "2019",
                ageGroup: "Young Adult",
                pages: 432,
                covers: ["https://books.google.com/books/content?id=EBoXDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },

            // Memoir & Non-Fiction
            {
                title: "Educated",
                author: "Tara Westover",
                isbn: "9780399590504",
                genre: "Memoir",
                published: "2018",
                ageGroup: "Adult",
                pages: 334,
                covers: ["https://books.google.com/books/content?id=2ObWDgAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "Becoming",
                author: "Michelle Obama",
                isbn: "9781524763138",
                genre: "Memoir",
                published: "2018",
                ageGroup: "Adult",
                pages: 448,
                covers: ["https://books.google.com/books/content?id=hi1yDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.5
            },
            {
                title: "Atomic Habits",
                author: "James Clear",
                isbn: "9780735211292",
                genre: "Self-Help",
                published: "2018",
                ageGroup: "Adult",
                pages: 320,
                covers: ["https://books.google.com/books/content?id=XfFvDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "Born a Crime",
                author: "Trevor Noah",
                isbn: "9780399588174",
                genre: "Memoir",
                published: "2016",
                ageGroup: "Adult",
                pages: 304,
                covers: ["https://books.google.com/books/content?id=v0mLCwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "Untamed",
                author: "Glennon Doyle",
                isbn: "9781984801258",
                genre: "Memoir",
                published: "2020",
                ageGroup: "Adult",
                pages: 352,
                covers: ["https://books.google.com/books/content?id=BqC_DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "Sapiens",
                author: "Yuval Noah Harari",
                isbn: "9780062316097",
                genre: "History",
                published: "2014",
                ageGroup: "Adult",
                pages: 464,
                covers: ["https://books.google.com/books/content?id=1EiJAwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },

            // Young Adult
            {
                title: "The Fault in Our Stars",
                author: "John Green",
                isbn: "9780525478812",
                genre: "Young Adult",
                published: "2012",
                ageGroup: "Young Adult",
                pages: 313,
                covers: ["https://books.google.com/books/content?id=UOgFz2VqzxgC&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "The Hunger Games",
                author: "Suzanne Collins",
                isbn: "9780439023528",
                genre: "Young Adult",
                published: "2008",
                ageGroup: "Young Adult",
                pages: 374,
                covers: ["https://books.google.com/books/content?id=_zKzAwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "Six of Crows",
                author: "Leigh Bardugo",
                isbn: "9781627792127",
                genre: "Young Adult Fantasy",
                published: "2015",
                ageGroup: "Young Adult",
                pages: 480,
                covers: ["https://books.google.com/books/content?id=MqFLCgAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.5
            },
            {
                title: "The Perks of Being a Wallflower",
                author: "Stephen Chbosky",
                isbn: "9780671027346",
                genre: "Young Adult",
                published: "1999",
                ageGroup: "Young Adult",
                pages: 224,
                covers: ["https://books.google.com/books/content?id=MDRRAAAACAAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "The Book Thief",
                author: "Markus Zusak",
                isbn: "9780375842207",
                genre: "Historical Fiction",
                published: "2005",
                ageGroup: "Young Adult",
                pages: 552,
                covers: ["https://books.google.com/books/content?id=2X5lN6xVFmEC&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },

            // Historical Fiction
            {
                title: "All the Light We Cannot See",
                author: "Anthony Doerr",
                isbn: "9781476746586",
                genre: "Historical Fiction",
                published: "2014",
                ageGroup: "Adult",
                pages: 544,
                covers: ["https://books.google.com/books/content?id=2gCtAAAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "The Nightingale",
                author: "Kristin Hannah",
                isbn: "9780312577223",
                genre: "Historical Fiction",
                published: "2015",
                ageGroup: "Adult",
                pages: 440,
                covers: ["https://books.google.com/books/content?id=dZZEAwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "The Pillars of the Earth",
                author: "Ken Follett",
                isbn: "9780451225245",
                genre: "Historical Fiction",
                published: "1989",
                ageGroup: "Adult",
                pages: 1008,
                covers: ["https://books.google.com/books/content?id=hJbpHAAACAAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.4
            },
            {
                title: "The Help",
                author: "Kathryn Stockett",
                isbn: "9780399155420",
                genre: "Historical Fiction",
                published: "2009",
                ageGroup: "Adult",
                pages: 544,
                covers: ["https://books.google.com/books/content?id=DRaygX8dZL8C&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "The Four Winds",
                author: "Kristin Hannah",
                isbn: "9781250178602",
                genre: "Historical Fiction",
                published: "2021",
                ageGroup: "Adult",
                pages: 464,
                covers: ["https://books.google.com/books/content?id=6g3_DwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },

            // Classic Literature
            {
                title: "To Kill a Mockingbird",
                author: "Harper Lee",
                isbn: "9780061120084",
                genre: "Classic Literature",
                published: "1960",
                ageGroup: "Young Adult",
                pages: 376,
                covers: ["https://books.google.com/books/content?id=PGR2AwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "1984",
                author: "George Orwell",
                isbn: "9780452284234",
                genre: "Classic Literature",
                published: "1949",
                ageGroup: "Adult",
                pages: 328,
                covers: ["https://books.google.com/books/content?id=kotPYEqx7kMC&printsec=frontcover&img=1&zoom=1"],
                rating: 4.2
            },
            {
                title: "Pride and Prejudice",
                author: "Jane Austen",
                isbn: "9780141439518",
                genre: "Classic Literature",
                published: "1813",
                ageGroup: "Adult",
                pages: 416,
                covers: ["https://books.google.com/books/content?id=L6wKGwAACAAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.3
            },
            {
                title: "The Great Gatsby",
                author: "F. Scott Fitzgerald",
                isbn: "9780743273565",
                genre: "Classic Literature",
                published: "1925",
                ageGroup: "Adult",
                pages: 180,
                covers: ["https://books.google.com/books/content?id=iUJcl93N9E0C&printsec=frontcover&img=1&zoom=1"],
                rating: 3.9
            },

            // Horror & Psychological
            {
                title: "Mexican Gothic",
                author: "Silvia Moreno-Garcia",
                isbn: "9780525620785",
                genre: "Horror",
                published: "2020",
                ageGroup: "Adult",
                pages: 320,
                covers: ["https://books.google.com/books/content?id=7pKdDwAAQBAJ&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            },
            {
                title: "The Haunting of Hill House",
                author: "Shirley Jackson",
                isbn: "9780143039983",
                genre: "Horror",
                published: "1959",
                ageGroup: "Adult",
                pages: 246,
                covers: ["https://books.google.com/books/content?id=Gl8wn7d9200C&printsec=frontcover&img=1&zoom=1"],
                rating: 4.1
            }
        ];

        let currentQuestion = 0;
        let answers = [];
        let userLocation = '';

        function startApp() {
            console.log('📚 Initializing Stacks...');
            loadBookAnimation();
            showQuestion(0);
            updateProgress();
        }

        function loadBookAnimation() {
            const lottieContainer = document.getElementById('header-lottie');
            lottieContainer.innerHTML = `
                <div style="
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(45deg, #8154a8, #6b4687, #9b6bb3);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: bookBounce 3s ease-in-out infinite;
                    position: relative;
                    overflow: hidden;
                ">
                    <div style="
                        width: 60%;
                        height: 70%;
                        background: white;
                        border-radius: 4px;
                        position: relative;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    ">
                        <div style="
                            position: absolute;
                            top: 10%;
                            left: 10%;
                            right: 10%;
                            height: 2px;
                            background: #8154a8;
                            border-radius: 1px;
                        "></div>
                        <div style="
                            position: absolute;
                            top: 25%;
                            left: 10%;
                            right: 10%;
                            height: 2px;
                            background: #8154a8;
                            border-radius: 1px;
                        "></div>
                        <div style="
                            position: absolute;
                            top: 40%;
                            left: 10%;
                            right: 30%;
                            height: 2px;
                            background: #8154a8;
                            border-radius: 1px;
                        "></div>
                    </div>
                </div>
            `;
        }

        function showQuestion(index) {
            console.log(`📝 Showing question ${index + 1}: ${questions[index].question}`);
            const container = document.getElementById('question-container');
            const question = questions[index];
            
            if (question.isLocation) {
                container.innerHTML = `
                    <div class="question active">
                        <h2>${question.question}</h2>
                        <div class="options">
                            <input type="text" class="location-input" id="location-input" 
                                   placeholder="Enter your city, state or ZIP code" 
                                   onkeypress="if(event.key==='Enter') selectLocation()">
                            <button class="continue-btn" id="continue-btn" 
                                    onclick="selectLocation()" disabled>
                                Continue
                            </button>
                        </div>
                    </div>
                `;
                
                const locationInput = document.getElementById('location-input');
                const continueBtn = document.getElementById('continue-btn');
                
                locationInput.addEventListener('input', function(e) {
                    continueBtn.disabled = e.target.value.trim().length === 0;
                });
                
                setTimeout(() => locationInput.focus(), 100);
                
            } else {
                const optionsHtml = question.options.map((option, i) => {
                    const safeOption = option.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
                    return `<button class="option" onclick="selectAnswer(${i}, '${safeOption}')">${option}</button>`;
                }).join('');
                
                container.innerHTML = `
                    <div class="question active">
                        <h2>${question.question}</h2>
                        <div class="options">
                            ${optionsHtml}
                        </div>
                    </div>
                `;
            }

            document.getElementById('current-question').textContent = index + 1;
            updateProgress();
        }

        function selectLocation() {
            const input = document.getElementById('location-input');
            const location = input.value.trim();
            
            if (location) {
                userLocation = location;
                answers.push({ question: currentQuestion, text: location });
                
                const questionEl = document.querySelector('.question.active');
                questionEl.style.opacity = '0';
                questionEl.style.transform = 'translateY(-20px)';
                
                setTimeout(() => {
                    showResults();
                }, 600);
            }
        }

        function selectAnswer(optionIndex, optionText) {
            console.log(`Selected: ${optionText}`);
            answers.push({ question: currentQuestion, answer: optionIndex, text: optionText });
            
            const questionEl = document.querySelector('.question.active');
            questionEl.style.opacity = '0';
            questionEl.style.transform = 'translateY(-20px)';
            
            setTimeout(() => {
                currentQuestion++;
                if (currentQuestion < questions.length) {
                    showQuestion(currentQuestion);
                }
            }, 600);
        }

        async function showResults() {
            console.log('🔍 Showing results...');
            document.querySelector('.progress').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('location-display').textContent = `Searching libraries near ${userLocation}`;
            
            document.getElementById('loading').style.display = 'block';
            
            // Generate personalized recommendations based on answers
            const recommendations = generateRecommendations();
            
            // Simulate API call delay
            setTimeout(() => {
                displayResults(recommendations);
                document.getElementById('loading').style.display = 'none';
            }, 2000);
        }

        function generateRecommendations() {
            // Enhanced recommendation logic based on user answers
            let selectedBooks = [...books];
            console.log(`Starting with ${selectedBooks.length} books`);
            
            // Filter based on reading vibe (first question)
            if (answers[0] && answers[0].answer !== undefined) {
                const vibe = answers[0].answer;
                if (vibe === 0) { // Heart-pounding excitement
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Thriller') || 
                        book.genre.includes('Mystery') || 
                        book.genre.includes('Science Fiction')
                    );
                } else if (vibe === 1) { // Cozy and comforting
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Contemporary') || 
                        book.genre.includes('Romance') ||
                        book.genre.includes('Literary') ||
                        book.rating >= 4.2
                    );
                } else if (vibe === 2) { // Make me think deeply
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Self-Help') || 
                        book.genre.includes('Memoir') ||
                        book.genre.includes('Literary')
                    );
                } else if (vibe === 3) { // Warm and emotional
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Literary') || 
                        book.genre.includes('Romance') ||
                        book.genre.includes('Contemporary') ||
                        book.genre.includes('Memoir')
                    );
                }
                console.log(`After vibe filter: ${selectedBooks.length} books`);
            }
            
            // Filter by page count (second question)
            if (answers[1] && answers[1].answer !== undefined) {
                const timePreference = answers[1].answer;
                if (timePreference === 0) { // Under 250 pages
                    selectedBooks = selectedBooks.filter(book => book.pages < 250);
                } else if (timePreference === 1) { // 250-400 pages
                    selectedBooks = selectedBooks.filter(book => book.pages >= 250 && book.pages <= 400);
                } else if (timePreference === 2) { // 400-600 pages
                    selectedBooks = selectedBooks.filter(book => book.pages > 400 && book.pages <= 600);
                } else if (timePreference === 3) { // 600+ pages
                    selectedBooks = selectedBooks.filter(book => book.pages > 600);
                }
                console.log(`After page filter: ${selectedBooks.length} books`);
            }

            // Filter by genre family (third question)
            if (answers[2] && answers[2].answer !== undefined) {
                const genreFamily = answers[2].answer;
                if (genreFamily === 0) { // Stories that feel real
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Contemporary') || 
                        book.genre.includes('Literary') ||
                        book.genre.includes('Memoir')
                    );
                } else if (genreFamily === 1) { // Fantasy & sci-fi adventures
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Fantasy') || 
                        book.genre.includes('Science Fiction')
                    );
                } else if (genreFamily === 2) { // True stories & real people
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Memoir') || 
                        book.genre.includes('Self-Help')
                    );
                } else if (genreFamily === 3) { // Help me learn & grow
                    selectedBooks = selectedBooks.filter(book => 
                        book.genre.includes('Self-Help') || 
                        book.genre.includes('Memoir')
                    );
                }
                console.log(`After genre filter: ${selectedBooks.length} books`);
            }
            
            // If filters are too restrictive, fallback to highly rated books
            if (selectedBooks.length === 0) {
                console.log('No books match filters, using highly rated fallback');
                selectedBooks = books.filter(book => book.rating >= 4.2).slice(0, 10);
            }
            
            // Sort by rating and return top recommendations
            selectedBooks.sort((a, b) => b.rating - a.rating);
            
            return selectedBooks.slice(0, 6); // Return top 6 recommendations
        }

        function showApiStatus(message, type) {
            const statusEl = document.getElementById('api-status');
            statusEl.textContent = message;
            statusEl.className = `api-status ${type}`;
            statusEl.style.display = 'block';
        }

        function getCoverHtml(book) {
            if (!book.covers || book.covers.length === 0) {
                return '<div class="book-cover">📚<br>No cover<br>available</div>';
            }
            
            return `
                <div class="book-cover">
                    <img src="${book.covers[0]}" 
                         alt="${book.title}" 
                         onload="this.style.opacity='1'"
                         onerror="handleCoverError(this)"
                         style="opacity: 0; transition: opacity 0.3s ease;">
                </div>
            `;
        }

        function handleCoverError(img) {
            console.log('Cover failed, showing placeholder');
            img.style.display = 'none';
            img.parentElement.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; 
                            height: 100%; background: #f0f0f0; color: #6c757d; font-size: 0.8rem;
                            border-radius: 8px;">
                    📚<br>Cover not<br>available
                </div>
            `;
        }

        function getLibraryLinks(book) {
            const cleanTitle = encodeURIComponent(book.title.replace(/[^\w\s]/g, ''));
            const cleanAuthor = encodeURIComponent(book.author.replace(/[^\w\s]/g, ''));
            
            return {
                googleBooks: `https://books.google.com/books?q=${cleanTitle}+${cleanAuthor}`,
                openLibrary: book.isbn ? 
                    `https://openlibrary.org/isbn/${book.isbn}` :
                    `https://openlibrary.org/search?q=${cleanTitle}+${cleanAuthor}`,
                worldcat: `https://www.worldcat.org/search?q=${cleanTitle}+${cleanAuthor}`,
                goodreads: `https://www.goodreads.com/search?q=${cleanTitle}+${cleanAuthor}`
            };
        }

        function displayResults(recommendations) {
            console.log('📊 Displaying book recommendations');
            showApiStatus(`Found ${recommendations.length} personalized book recommendations for you!`, 'success');
            
            const grid = document.getElementById('results-grid');
            
            grid.innerHTML = recommendations.map(book => {
                const links = getLibraryLinks(book);
                
                return `
                    <div class="book-card">
                        ${getCoverHtml(book)}
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">by ${book.author}</div>
                        <div class="book-details">
                            <div><strong>Genre:</strong> ${book.genre}</div>
                            <div><strong>Published:</strong> ${book.published}</div>
                            <div><strong>Pages:</strong> ${book.pages}</div>
                            <div><strong>Rating:</strong> ${book.rating}/5 ⭐</div>
                        </div>
                        <div class="availability">
                            <div class="availability-status">📚 Find This Book</div>
                            <div class="library-info">Search multiple sources near ${userLocation}</div>
                            <a href="${links.googleBooks}" target="_blank" class="library-link">Google Books</a>
                            <a href="${links.openLibrary}" target="_blank" class="library-link">Open Library</a>
                            <a href="${links.goodreads}" target="_blank" class="library-link">Goodreads</a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function restartQuiz() {
            currentQuestion = 0;
            answers = [];
            userLocation = '';
            document.querySelector('.progress').style.display = 'block';
            document.querySelector('.progress-container').style.display = 'block';
            document.getElementById('question-container').style.display = 'flex';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('api-status').style.display = 'none';
            startApp();
        }

        // Start the app when page loads
        console.log('🌟 Starting Stacks initialization...');
        startApp();
    </script>
</body>
</html>