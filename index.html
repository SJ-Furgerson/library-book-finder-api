<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacks - Find Books at Your Library</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Condensed:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0f;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
            overflow-x: hidden;
        }

        /* HD cosmic background image */
        .cosmic-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-image: url('https://i.ytimg.com/vi/eTD0WWFIDAg/maxresdefault.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* Dark overlay for better text readability */
        .cosmic-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.6;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }

        .star:nth-child(odd) {
            animation-delay: 1s;
        }

        .star:nth-child(3n) {
            animation-delay: 2s;
        }

        @keyframes cosmicFlow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .header {
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-align: center;
            letter-spacing: 0.1em;
            color: #ff6b9d;
            text-transform: uppercase;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            text-align: center;
            margin-bottom: 3rem;
            max-width: 600px;
            color: #e0e6ed;
        }

        .progress-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #c44569, #f8b500);
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        .question-container {
            max-width: 600px;
            width: 100%;
            text-align: center;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
        }

        .question {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease;
            position: absolute;
            width: 100%;
            max-width: 600px;
        }

        .question.active {
            opacity: 1;
            transform: translateY(0);
            position: relative;
        }

        .question h2 {
            font-size: 1.8rem;
            font-weight: 500;
            margin-bottom: 2rem;
            line-height: 1.4;
            color: white;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.9);
            color: #0a0a0f;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.3);
        }

        .location-input {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-family: inherit;
            backdrop-filter: blur(10px);
        }

        .location-input:focus {
            outline: none;
            border-color: #ff6b9d;
            background: rgba(255, 255, 255, 0.15);
        }

        .location-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .continue-btn {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .continue-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        }

        .continue-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress {
            position: absolute;
            top: 2rem;
            right: 2rem;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.7;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .results-container {
            display: none;
            max-width: 1200px;
            width: 100%;
            margin-top: 2rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.2rem;
            opacity: 0.8;
            color: white;
        }

        /* Simple loading spinner - no fake lottie */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #ff6b9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-header h2 {
            font-family: 'Roboto Condensed', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .location-info {
            font-size: 1rem;
            opacity: 0.8;
            color: #e0e6ed;
        }

        .api-status {
            background: rgba(255, 243, 205, 0.1);
            border: 1px solid rgba(255, 234, 167, 0.3);
            color: #fff3cd;
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        .api-status.success {
            background: rgba(212, 237, 218, 0.1);
            border-color: rgba(195, 230, 203, 0.3);
            color: #d4edda;
        }

        .api-status.error {
            background: rgba(248, 215, 218, 0.1);
            border-color: rgba(245, 198, 203, 0.3);
            color: #f8d7da;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .book-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(255, 107, 157, 0.2);
            border-color: rgba(255, 107, 157, 0.3);
        }

        .book-cover {
            width: 120px;
            height: 180px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: white;
        }

        .book-author {
            font-size: 1rem;
            font-weight: 400;
            opacity: 0.8;
            margin-bottom: 1rem;
            color: #e0e6ed;
        }

        .book-details {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 1rem;
            color: #c7d2fe;
        }

        .availability {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 1rem;
            margin-top: auto;
            backdrop-filter: blur(10px);
        }

        .available {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
        }

        .availability-status {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: white;
        }

        .available .availability-status {
            color: #4ade80;
        }

        .library-info {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: #e0e6ed;
        }

        .library-link {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 0.2rem 0.2rem 0 0;
        }

        .library-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
        }

        .library-link.secondary {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 0.5rem 1rem;
            margin: 0.2rem 0.2rem 0 0;
        }

        .library-link.secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
        }

        .restart-btn {
            margin: 3rem auto 0;
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            display: block;
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 157, 0.4);
        }

        @media (max-width: 768px) {
            .header {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }
            
            .subtitle {
                font-size: 1rem;
                margin-bottom: 2rem;
            }
            
            .question h2 {
                font-size: 1.4rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }

            .progress {
                position: static;
                text-align: center;
                margin-bottom: 1rem;
            }

            .question-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="cosmic-background"></div>
    <div class="stars" id="stars"></div>

    <div class="progress">
        <span id="current-question">1</span> / 7
    </div>

    <h1 class="header">Stacks</h1>
    <p class="subtitle">CRACK YOUR NEXT BOOK</p>

    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>

    <div class="question-container" id="question-container">
        <!-- Questions will be dynamically inserted here -->
    </div>

    <div class="results-container" id="results-container">
        <div class="results-header">
            <h2>Your Book Matches</h2>
            <div class="location-info" id="location-display"></div>
        </div>
        
        <div class="api-status" id="api-status" style="display: none;">
            <!-- API status messages will appear here -->
        </div>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div>Finding your matches...</div>
        </div>
        
        <div class="results-grid" id="results-grid">
            <!-- Results will be dynamically inserted here -->
        </div>
        <button class="restart-btn" onclick="restartQuiz()">Discover more books</button>
    </div>

    <script>
        console.log('🚀 Starting BookVibe...');

        // Create animated stars
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const numStars = 50;
            
            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Update progress bar
        function updateProgress() {
            const progressFill = document.getElementById('progress-fill');
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            progressFill.style.width = progress + '%';
        }
        
        // Simple questions array
        const questions = [
            {
                question: "What's your reading vibe right now?",
                options: ["Heart-pounding excitement", "Cozy and comforting", "Make me think deeply", "Warm and emotional"]
            },
            {
                question: "How much reading time do you have?",
                options: ["A quick escape (under 250 pages)", "Perfect weekend read (250-400 pages)", "I'm committed (400-600 pages)", "Bring on the epic (600+ pages)"]
            },
            {
                question: "What genre family calls to you?",
                options: ["Stories that feel real", "Fantasy & sci-fi adventures", "True stories & real people", "Help me learn & grow"]
            },
            {
                question: "Who's this book for?",
                options: ["Me (adult content welcome)", "Young adult (16-25 vibe)", "Younger reader (10-15)", "Family-friendly for everyone"]
            },
            {
                question: "What's your book discovery style?",
                options: ["Give me the crowd favorites", "I want hidden gems", "Mix of popular and unique", "I trust your judgment"]
            },
            {
                question: "When it comes to publication date?",
                options: ["Fresh off the press (2020+)", "Modern classics (2000-2020)", "Timeless favorites (1990s-2000s)", "Age doesn't matter to me"]
            },
            {
                question: "Where are you located?",
                isLocation: true
            }
        ];

        // Book database with Google Books covers prioritized
        const books = [
            {
                title: "The Seven Husbands of Evelyn Hugo",
                author: "Taylor Jenkins Reid",
                isbn: "9781501161933",
                genre: "Contemporary Fiction",
                published: "2017",
                ageGroup: "Adult",
                pages: 400,
                covers: [
                    "https://books.google.com/books/content?id=WI5PDQAAQBAJ&printsec=frontcover&img=1&zoom=1",
                    "https://covers.openlibrary.org/b/isbn/9781501161933-L.jpg"
                ],
                rating: 4.4
            },
            {
                title: "Where the Crawdads Sing",
                author: "Delia Owens",
                isbn: "9780735219090",
                genre: "Literary Fiction",
                published: "2018",
                ageGroup: "Adult",
                pages: 384,
                covers: [
                    "https://books.google.com/books/content?id=mSc5DwAAQBAJ&printsec=frontcover&img=1&zoom=1",
                    "https://covers.openlibrary.org/b/isbn/9780735219090-L.jpg"
                ],
                rating: 4.1
            },
            {
                title: "The House in the Cerulean Sea",
                author: "TJ Klune",
                isbn: "9781250217318",
                genre: "Fantasy",
                published: "2020",
                ageGroup: "Adult",
                pages: 394,
                covers: [
                    "https://books.google.com/books/content?id=Y8u8DwAAQBAJ&printsec=frontcover&img=1&zoom=1",
                    "https://covers.openlibrary.org/b/isbn/9781250217318-L.jpg"
                ],
                rating: 4.3
            },
            {
                title: "Educated",
                author: "Tara Westover",
                isbn: "9780399590504",
                genre: "Memoir",
                published: "2018",
                ageGroup: "Adult",
                pages: 334,
                covers: [
                    "https://books.google.com/books/content?id=2ObWDgAAQBAJ&printsec=frontcover&img=1&zoom=1",
                    "https://covers.openlibrary.org/b/isbn/9780399590504-L.jpg"
                ],
                rating: 4.4
            },
            {
                title: "Dune",
                author: "Frank Herbert",
                isbn: "9780441172719",
                genre: "Science Fiction",
                published: "1965",
                ageGroup: "Adult",
                pages: 688,
                covers: [
                    "https://books.google.com/books/content?id=B1hSG45JCX4C&printsec=frontcover&img=1&zoom=1",
                    "https://covers.openlibrary.org/b/isbn/9780441172719-L.jpg"
                ],
                rating: 4.2
            }
        ];

        let currentQuestion = 0;
        let answers = [];
        let userLocation = '';

        function startApp() {
            console.log('📚 Initializing Stacks...');
            createStars();
            showQuestion(0);
            updateProgress();
        }

        function showQuestion(index) {
            console.log(`📝 Showing question ${index + 1}: ${questions[index].question}`);
            const container = document.getElementById('question-container');
            const question = questions[index];
            
            if (question.isLocation) {
                container.innerHTML = `
                    <div class="question active">
                        <h2>${question.question}</h2>
                        <div class="options">
                            <input type="text" class="location-input" id="location-input" 
                                   placeholder="Enter your city, state or ZIP code" 
                                   onkeypress="if(event.key==='Enter') selectLocation()">
                            <button class="continue-btn" id="continue-btn" 
                                    onclick="selectLocation()" disabled>
                                Continue
                            </button>
                        </div>
                    </div>
                `;
                
                document.getElementById('location-input').addEventListener('input', function(e) {
                    document.getElementById('continue-btn').disabled = e.target.value.trim().length === 0;
                });
                
                setTimeout(() => document.getElementById('location-input').focus(), 100);
                
            } else {
                container.innerHTML = `
                    <div class="question active">
                        <h2>${question.question}</h2>
                        <div class="options">
                            ${question.options.map((option, i) => 
                                `<button class="option" onclick="selectAnswer(${i}, '${option.replace(/'/g, "&apos;")}')">${option}</button>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }

            document.getElementById('current-question').textContent = index + 1;
            updateProgress();
        }

        function selectLocation() {
            const input = document.getElementById('location-input');
            const location = input.value.trim();
            
            if (location) {
                userLocation = location;
                answers.push({ question: currentQuestion, text: location });
                
                const questionEl = document.querySelector('.question.active');
                questionEl.style.opacity = '0';
                questionEl.style.transform = 'translateY(-20px)';
                
                setTimeout(() => {
                    showResults();
                }, 600);
            }
        }

        function selectAnswer(optionIndex, optionText) {
            console.log(`Selected: ${optionText}`);
            answers.push({ question: currentQuestion, answer: optionIndex, text: optionText });
            
            const questionEl = document.querySelector('.question.active');
            questionEl.style.opacity = '0';
            questionEl.style.transform = 'translateY(-20px)';
            
            setTimeout(() => {
                currentQuestion++;
                if (currentQuestion < questions.length) {
                    showQuestion(currentQuestion);
                }
            }, 600);
        }

        async function showResults() {
            console.log('🔍 Showing results...');
            document.querySelector('.progress').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('results-container').style.display = 'block';
            document.getElementById('location-display').textContent = `Searching libraries near ${userLocation}`;
            
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Try the real library API first
                await searchRealLibraries();
                
            } catch (error) {
                console.error('Search error:', error);
                displayFallbackResults('Search failed - showing alternative links');
            }
            
            document.getElementById('loading').style.display = 'none';
        }

        async function searchRealLibraries() {
            try {
                console.log(`🔍 Attempting real library search near ${userLocation}`);
                
                showApiStatus('Connecting to library systems...', 'info');
                
                const response = await fetch('https://library-book-finder-api-production.up.railway.app/api/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ books: books, location: userLocation })
                });
                
                if (!response.ok) {
                    throw new Error(`Library API returned ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.results.length > 0) {
                    console.log(`✅ Library API success: ${data.results.length} books`);
                    showApiStatus(`Found books in local library systems`, 'success');
                    displayRealLibraryResults(data.results);
                } else {
                    throw new Error('No results from library API');
                }
                
            } catch (error) {
                console.error('❌ Library API failed:', error.message);
                showApiStatus('Library systems temporarily unavailable - showing alternative search options', 'error');
                displayFallbackResults('Using alternative book search methods');
            }
        }

        function showApiStatus(message, type) {
            const statusEl = document.getElementById('api-status');
            statusEl.textContent = message;
            statusEl.className = `api-status ${type}`;
            statusEl.style.display = 'block';
        }

        function getCoverHtml(book) {
            if (!book.covers || book.covers.length === 0) {
                return '<div class="book-cover">📚<br>No cover<br>available</div>';
            }
            
            return `
                <div class="book-cover">
                    <img src="${book.covers[0]}" 
                         alt="${book.title}" 
                         data-fallback="${book.covers[1] || ''}"
                         onload="this.style.opacity='1'"
                         onerror="handleCoverError(this)"
                         style="opacity: 0; transition: opacity 0.3s ease;">
                </div>
            `;
        }

        function handleCoverError(img) {
            const fallback = img.dataset.fallback;
            if (fallback && img.src !== fallback) {
                console.log('Cover failed, trying fallback:', fallback);
                img.src = fallback;
            } else {
                console.log('All cover sources failed, showing placeholder');
                img.style.display = 'none';
                img.parentElement.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; 
                                height: 100%; background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-size: 0.8rem;
                                border-radius: 8px;">
                        📚<br>Cover not<br>available
                    </div>
                `;
            }
        }

        function getLibraryLinks(book) {
            const cleanTitle = encodeURIComponent(book.title.replace(/[^\w\s]/g, ''));
            const cleanAuthor = encodeURIComponent(book.author.replace(/[^\w\s]/g, ''));
            
            return {
                googleBooks: `https://books.google.com/books?q=${cleanTitle}+${cleanAuthor}`,
                openLibrary: book.isbn ? 
                    `https://openlibrary.org/isbn/${book.isbn}` :
                    `https://openlibrary.org/search?q=${cleanTitle}+${cleanAuthor}`
            };
        }

        function displayRealLibraryResults(apiResults) {
            console.log('📊 Displaying real library results');
            const grid = document.getElementById('results-grid');
            
            grid.innerHTML = apiResults.map(book => {
                const hasAvailability = book.availability && book.availability.length > 0;
                const links = getLibraryLinks(book);
                
                return `
                    <div class="book-card">
                        ${getCoverHtml(book)}
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">by ${book.author}</div>
                        <div class="book-details">
                            <div><strong>Genre:</strong> ${book.genre}</div>
                            <div><strong>Published:</strong> ${book.published}</div>
                            <div><strong>Pages:</strong> ${book.pages}</div>
                            <div><strong>Rating:</strong> ${book.rating}/5 ⭐</div>
                        </div>
                        
                        ${hasAvailability ? 
                            book.availability.map(avail => `
                                <div class="availability available">
                                    <div class="availability-status">✅ ${avail.status}</div>
                                    <div class="library-info">${avail.library}</div>
                                    <a href="${avail.url}" target="_blank" class="library-link">Check Library</a>
                                    <a href="${links.googleBooks}" target="_blank" class="library-link secondary">Google Books</a>
                                    <a href="${links.openLibrary}" target="_blank" class="library-link secondary">Open Library</a>
                                </div>
                            `).join('') :
                            `<div class="availability">
                                <div class="availability-status">📚 Find This Book</div>
                                <div class="library-info">Multiple search options available</div>
                                <a href="${links.googleBooks}" target="_blank" class="library-link">Google Books</a>
                                <a href="${links.openLibrary}" target="_blank" class="library-link secondary">Open Library</a>
                            </div>`
                        }
                    </div>
                `;
            }).join('');
        }

        function displayFallbackResults(reason) {
            console.log('📚 Displaying fallback results:', reason);
            const grid = document.getElementById('results-grid');
            
            grid.innerHTML = books.slice(0, 5).map(book => {
                const links = getLibraryLinks(book);
                
                return `
                    <div class="book-card">
                        ${getCoverHtml(book)}
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">by ${book.author}</div>
                        <div class="book-details">
                            <div><strong>Genre:</strong> ${book.genre}</div>
                            <div><strong>Published:</strong> ${book.published}</div>
                            <div><strong>Pages:</strong> ${book.pages}</div>
                            <div><strong>Rating:</strong> ${book.rating}/5 ⭐</div>
                        </div>
                        <div class="availability">
                            <div class="availability-status">📚 Find This Book</div>
                            <div class="library-info">Multiple search options available</div>
                            <a href="${links.googleBooks}" target="_blank" class="library-link">Google Books</a>
                            <a href="${links.openLibrary}" target="_blank" class="library-link secondary">Open Library</a>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function restartQuiz() {
            currentQuestion = 0;
            answers = [];
            userLocation = '';
            document.querySelector('.progress').style.display = 'block';
            document.querySelector('.progress-container').style.display = 'block';
            document.getElementById('question-container').style.display = 'flex';
            document.getElementById('results-container').style.display = 'none';
            document.getElementById('api-status').style.display = 'none';
            startApp();
        }

        // Start the app when page loads
        console.log('🌟 Starting Stacks initialization...');
        startApp();
    </script>
</body>
</html>